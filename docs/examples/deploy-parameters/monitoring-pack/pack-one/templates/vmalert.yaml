{{- if .Values.vmAlert.install }}
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMAlert
metadata:
  labels:
    name: vmalert
    app.kubernetes.io/name: vmalert
    app.kubernetes.io/component: victoriametrics
    app.kubernetes.io/part-of: monitoring
    app.kubernetes.io/managed-by: monitoring-operator
    {{- $labelCtx := dict "commonLabels" .Values.commonLabels "componentLabels" .Values.vmAlert.labels }}
    {{- include "monitoring-pack-one.metadata.labels" $labelCtx | nindent 4 }}
  annotations:
    operator.victoriametrics.com/vmalert-deduplicate-rules: "true"
    {{- $annotationCtx := dict "commonAnnotations" .Values.commonAnnotations "componentAnnotations" .Values.vmAlert.annotations }}
    {{- include "monitoring-pack-one.metadata.annotations" $annotationCtx | nindent 4 }}
  name: {{ default (printf "%s-vmalert" (include "monitoring-pack-one.fullname" .)) .Values.vmAlert.name }}
  namespace: {{ include "monitoring-pack-one.namespace" . }}
spec:
  replicaCount: 1
  evaluationInterval: "30s"
  resources: {}
  securityContext:
    fsGroup: 2000
    runAsUser: 2000

  # Enable discovery all CRs if labelSelectors is empty
  selectAllByDefault: true

  # Selector to discovery CRs
  # Exclude the OpenShift Monitoring configurations
  ruleSelector: {}
  ruleNamespaceSelector:
    matchExpressions:
      - key: openshift.io/cluster-monitoring
        operator: NotIn
        values: ["true"]

  serviceAccountName: {{ include "monitoring-pack-one.vmalert.serviceAccountName" . }}
{{- if .Values.vmAlert.spec }}
{{ toYaml .Values.vmAlert.spec | indent 2 }}
{{- end }}
{{- end }}
